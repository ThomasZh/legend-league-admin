<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">

  <title>{{ admin['league_name'] }} | 加盟商信息修改</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="{{ static_url('jquery-weui/css/weui.min.css') }}">
  <link rel="stylesheet" href="{{ static_url('jquery-weui/css/jquery-weui.min.css') }}">
  <link href="{{ static_url('gentelella/bootstrap/dist/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ static_url('gentelella/fontawesome/css/font-awesome.min.css') }}" rel="stylesheet">
  <link href="{{ static_url('gentelella/animate.css/animate.min.css') }}" rel="stylesheet">

  <!-- Custom styling plus plugins -->
  <link href="{{ static_url('css/custom.css') }}" rel="stylesheet">
  <link href="{{ static_url('gentelella/iCheck/skins/flat/green.css') }}" rel="stylesheet">
  <script src="{{ static_url('gentelella/jquery/dist/jquery.min.js') }}"></script>

  <link rel="stylesheet" href="{{ static_url('upyun/css/fileinput.min.css') }}" />

  <!-- fileinput -->
  <script src="{{ static_url('upyun/js/fileinput.min.js') }}"></script>
  <script src="{{ static_url('upyun/js/spark-md5.min.js') }}"></script>
  <script src="{{ static_url('upyun/js/async.js') }}"></script>
  <script src="{{ static_url('upyun/js/upyun-mu.js') }}"></script>

</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">
      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">

          <!-- menu profile quick info -->
          {% module Template("admin/block-menu-prile-quick-info.html", admin=admin) %}
          <!-- /menu profile quick info -->
          <br />

          <!-- sidebar menu -->
          {% module Template("admin/block-sidebar-menu.html", counter=counter) %}
          <!-- /sidebar menu -->
          <br />

          <!-- /menu footer buttons -->
          {% module Template("admin/block-menu-footer.html") %}
          <!-- /menu footer buttons -->
        </div>
      </div>

      <!-- top navigation -->
      {% module Template("admin/block-top-nav.html", admin=admin) %}
      <!-- /top navigation -->

      <!-- page content -->
      <div class="right_col" role="main">

        <div class="">
          <div style="height:auto;" class="page-title">
            <div class="title_left">
              <h3>加盟管理</h3>
            </div>

            <div class="clearfix"></div>

            <div class="row">

              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>加盟申请详情</h2>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <form class="form-horizontal form-label-left" action="/admin/todo-detail/edit" method="POST">
                      <input type="hidden" name="club_id" value="{{ club_id }}">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称</th>
                            <th>内&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;容</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>审核状态</td>
                            {% if franchise['_status'] == 0 %}
                            <td>待审核</td> {% elif franchise['_status'] == 20 %}
                            <td>已批准</td> {% elif franchise['_status'] == 10 %}
                            <td>已拒绝</td> {% end %}
                          </tr>
                          <tr>
                            <td>申请时间</td>
                            <td>{{ franchise['create_time'] }}</td>
                          </tr>
                          <tr>
                            <td>加盟名称</td>
                            <td>
                              <div class="col-md-4 col-sm-12 col-xs-12">
                                <input type="text" name="name" class="form-control" value="{{ franchise['club']['name'] }}"/>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td>加盟类型</td>
                            <td>
                              <div class="col-md-4 col-sm-12 col-xs-12">
                              {% if franchise['club']['franchise_type'] == 'scenery' %}
                						    <label>
                						      <input type="radio" name="franchise_type" value="scenery" id="RadioGroup1_0" checked="checked" class="yk_label" />
                						      风景区</label>
                						    <label>
                						      <input type="radio" name="franchise_type" value="supplier" id="RadioGroup1_1" class="yk_label" />
                						      供应商</label>
                							{% else %}
                								<label>
                									<input type="radio" name="franchise_type" value="scenery" id="RadioGroup1_0" class="yk_label" />
                									风景区</label>
                								<label>
                									<input type="radio" name="franchise_type" value="supplier" id="RadioGroup1_1" checked="checked" class="yk_label" />
                									供应商</label>
                							{% end %}
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td>联系电话</td>
                            <td>
                              <div class="col-md-4 col-sm-12 col-xs-12">
                                <input type="text" name="phone" class="form-control" value="{{ franchise['club']['phone'] }}"/>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td>电子邮箱</td>
                            <td>
                              <div class="col-md-4 col-sm-12 col-xs-12">
                                <input type="text" name="email" class="form-control" value="{{ franchise['club']['email'] }}"/></td>
                              </div>
                          </tr>
                          <tr>
                            <td>地址</td>
                            <td>
                              <div class="col-md-12 col-sm-12 col-xs-12" id="distpicker">
                  			          <select class="form-control" style="display:inline-block;width:20%;" name="province" id="province"></select>
                  			          <select class="form-control" style="display:inline-block;width:20%;" name="city" id="city"></select>
                  			      </div>
                            </td>
                          </tr>
                          <tr>
                            <td>背景图</td>
                            <td>
                              <div class="col-md-3 col-sm-12 col-xs-12">
                  							<img id="user_img" src="{{ franchise['club']['img'] }}" alt="背景图" style="width:100%;border:1px solid #e2e6e5;margin-left: 0;" />
                                <input type="hidden" name="img" id="fr_img" value="{{ franchise['club']['img'] }}" />
                                <button type="button" class="btn btn-success" onclick="openBrowse()">修改背景图</button>
                  							<input type="file" id="file" name="file" style="display:none;">
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td>简介</td>
                            <td>
                              <textarea class="form-control" rows="8" style="resize: none;" name="introduction">{{ franchise['club']['introduction'] }}</textarea>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <div class="form-group">
                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                          <button type="submit" class="btn btn-success">修改</button>
                        </div>
                      </div>
                  </form>
                </div>
              </div>
          </div>

          </div>
        </div>

        <!-- footer content -->
        {% module Template("admin/block-footer.html", admin=admin) %}
        <!-- /footer content -->

      </div>
      <!-- /page content -->

    </div>
  </div>

  <script src="{{ static_url('gentelella/bootstrap/dist/js/bootstrap.min.js') }}" type="text/javascript"></script>
  <script src="{{ static_url('js/custom.js') }}" type="text/javascript"></script>
  <script src="{{ static_url('weui/lib/fastclick.js') }}"></script>
  <script src="{{ static_url('js/distpicker.data.js') }}"></script>
  <script src="{{ static_url('js/distpicker.js') }}"></script>
  <script src="{{ static_url('jquery-weui/js/jquery-weui.min.js') }}"></script>
  <!-- fileinput -->
  <script src="{{ static_url('upyun/js/fileinput.min.js') }}"></script>
  <script src="{{ static_url('upyun/js/spark-md5.min.js') }}"></script>
  <script src="{{ static_url('upyun/js/async.js') }}"></script>
  <script src="{{ static_url('upyun/js/upyun-mu.js') }}"></script>
  <script>

  	function uuid() {
  		var s = [];
  		var hexDigits = "0123456789abcdef";
  		for (var i = 0; i < 36; i++) {
  			s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
  		}
  		s[14] = "4"; // bits 12-15 of the time_hi_and_version field to 0010
  		s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01
  		s[8] = s[13] = s[18] = s[23] = "-";

  		var uuid = s.join("");
  		return uuid;
  	}

  	function uploadUpyun(file, elementId) {
  		var ext = '.' + file.name.split('.').pop();

  		var config = {
  			// 空间名称
  			bucket: '{{upyun_bucket}}',
  			// 上传请求过期时间
  			expiration: parseInt((new Date().getTime() + 3600000) / 1000),
  			// 尽量不要使用直接传表单 API 的方式，以防泄露造成安全隐患
  			form_api_secret: '{{upyun_form_api_secret}}'
  		};

  		var instance = new Sand(config);
  		var options = {
  			'notify_url': '{{upyun_notify_url}}'
  		};
  		instance.setOptions(options);
  		instance.setElementId(elementId);

  		var d = new Date();
  		var month = d.getMonth() + 1;
  		var filename = '/avatar/' + d.getFullYear() + '/' + month + '/' + d.getDate() + '/' + uuid() + ext;
  		console.log(filename);
  		instance.upload(filename);

  		return '{{upyun_domain}}' + filename;
  	};

  	$("#file").on("change", function() {
  		var times = 0;
  		var imgUrl = uploadUpyun(this.files[0], "file");
  		$.showLoading("图片上传中...");
  		document.addEventListener('uploaded', function(e) {
  			if (times == 0) {
  				$("#user_img").attr('src', imgUrl);
          $("#fr_img").val(imgUrl);
  			}
  			$.hideLoading();
  			times++;
  		});

  	});
  	// 打开文件
  	function openBrowse() {
  		var ie = navigator.appName == "Microsoft Internet Explorer" ? true : false;
  		if (ie) {
  			document.getElementById("file").click();
  			document.getElementById("filename").value = document.getElementById("file").value;
  		} else {
  			var a = document.createEvent("MouseEvents"); //FF的处理
  			a.initEvent("click", true, true);
  			document.getElementById("file").dispatchEvent(a);
  		}
  	}
  </script>
  <script>
  	 $(function() {
  		// $("#distpicker").distpicker('destroy');
   	  $('#distpicker').distpicker({
  			{% if franchise %}
   	    province: "{{ franchise['club']['province'] }}",
   	    city: "{{ franchise['club']['city'] }}",
  			{% end %}
   	  });
  	});
  </script>
</body>
</html>
