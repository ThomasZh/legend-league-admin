<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">

  <title>传奇联盟</title>

  <!-- Bootstrap core CSS -->

  <link href="{{ static_url('gentelella/bootstrap/dist/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ static_url('gentelella/fontawesome/css/font-awesome.min.css') }}" rel="stylesheet">
  <link href="{{ static_url('gentelella/animate.css/animate.min.css') }}" rel="stylesheet">

  <!-- Custom styling plus plugins -->
  <link href="{{ static_url('css/custom.css') }}" rel="stylesheet">
  <link href="{{ static_url('gentelella/iCheck/skins/flat/green.css') }}" rel="stylesheet">
  <script src="{{ static_url('gentelella/jquery/dist/jquery.min.js') }}"></script>

  <!-- Custom styling plus plugins -->
  <link href="{{ static_url('gentelella/css/maps/jquery-jvectormap-2.0.3.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('gentelella/css/floatexamples.css') }}" rel="stylesheet" type="text/css" />
  <script src="{{ static_url('gentelella/nprogress/nprogress.js') }}"></script>

  <!--[if lt IE 9]>
        <script src="../assets/js/ie8-responsive-file-warning.js"></script>
        <![endif]-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
  <script src="{{ static_url('js/json2.js') }}" type="text/javascript"></script>

</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">
      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">
          <div class="navbar nav_title" style="border: 0;">
            <a href="/" class="site_title"><i class="fa fa-support"></i> <span>传奇联盟</span></a>
          </div>

          <div class="clearfix"></div>

          <!-- menu profile quick info -->
          {% module Template("admin/block-menu-prile-quick-info.html", admin=admin) %}
          <!-- /menu profile quick info -->
          <br />

          <!-- sidebar menu -->
          {% module Template("admin/block-sidebar-menu.html") %}
          <!-- /sidebar menu -->
          <br />

          <!-- /menu footer buttons -->
          {% module Template("admin/block-menu-footer.html") %}
          <!-- /menu footer buttons -->
        </div>
      </div>

      <!-- top navigation -->
      {% module Template("admin/block-top-nav.html", admin=admin) %}
      <!-- /top navigation -->

      <!-- page content -->
      <div class="right_col" role="main">

        <div class="">
          <div style="height:auto;" class="page-title">
            <div class="title_left">
              <h3>待办事项</h3>
            </div>

            <div class="clearfix"></div>

            <div class="row" id="mgmt-table">

              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>加盟申请</h2>
                    <ul class="nav navbar-right panel_toolbox">
                    </ul>
                    <div class="clearfix"></div>
                  </div>

                  <div class="x_content">
                    <div class="table-responsive">
                      <table class="table table-striped jambo_table bulk_action">
                        <thead>
                          <tr class="headings">
                            <th>
                              <input type="checkbox" id="check-all" class="flat">
                            </th>
                            <th class="column-title">头像 </th>
                            <th class="column-title">昵称 </th>
                            <th class="column-title">联系方式 </th>
                            <th class="column-title">俱乐部信息 </th>
                            <th class="column-title">状态 </th>
                            <th class="column-title">申请日期 </th>
                            <th class="column-title no-link last"><span class="nobr">操作</span>
                            </th>
                            <th class="bulk-actions" colspan="1">
                              <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt"> </span> ) <i class="fa fa-chevron-down"></i></a>
                            </th>
                          </tr>
                        </thead>

                        <tbody>
                          <tr class="even pointer" is="oneFranchise" v-for="(franchise,idx) in franchises" v-bind:franchise="franchise" v-bind:idx="idx"></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- footer content -->
        {% module Template("admin/block-footer.html") %}
        <!-- /footer content -->

      </div>
      <!-- /page content -->

    </div>
  </div>

  <script src="{{ static_url('gentelella/bootstrap/dist/js/bootstrap.min.js') }}" type="text/javascript"></script>
  <!-- gauge js -->
  <script src="{{ static_url('gentelella/gauge.js/dist/gauge.min.js') }}" type="text/javascript"></script>
  <!-- chart js -->
  <script src="{{ static_url('gentelella/Chart.js/dist/chart.min.js') }}" type="text/javascript"></script>
  <!-- bootstrap progress js -->
  <script src="{{ static_url('gentelella/bootstrap-progressbar/bootstrap-progressbar.min.js') }}" type="text/javascript"></script>
  <script src="{{ static_url('gentelella/js/nicescroll/jquery.nicescroll.min.js') }}" type="text/javascript"></script>
  <!-- icheck -->
  <script src="{{ static_url('gentelella/iCheck/icheck.min.js') }}" type="text/javascript"></script>
  <!-- daterangepicker -->
  <script src="{{ static_url('gentelella/moment/min/moment.min.js') }}" type="text/javascript"></script>
  <script src="{{ static_url('gentelella/bootstrap-daterangepicker/daterangepicker.js') }}" type="text/javascript"></script>

  <script src="{{ static_url('js/custom.js') }}" type="text/javascript"></script>
  <script src="{{ static_url('js/vue-2.1.4.js') }}" type="text/javascript"></script>

  <script>
    Vue.component('oneFranchise', {
      template: '\
        <tr class="even pointer">\
          <td class="a-center "><input type="checkbox" class="flat" name="table_records"></td>\
          <td class=" "><img :src="franchise.avatar" class="avatar" alt="avatar"></td>\
          <td class=" ">{{! franchise.nickname }}</td>\
          <td class=" ">\
            <span v-for="login in franchise.logins">{{! login }}</span><br />\
          </td>\
          <td class=" ">{{! franchise._id }}</td>\
          <td class=" ">\
            <span v-if="franchise._status == 0">待审批</span>\
            <span v-if="franchise._status == 20">接受</span>\
            <span v-if="franchise._status == 10">拒绝</span>\
          </td>\
          <td class=" ">{{! franchise.create_time }}</td>\
          <td class="last">\
            <a v-on:click="review" type="button" class="btn btn-round btn-sm btn-info">查看详情</a>\
            <a v-if="franchise._status == 0" v-on:click="accept" type="button" class="btn btn-round btn-sm btn-success">接受</a>\
            <a v-if="franchise._status == 0" v-on:click="reject" type="button" class="btn btn-round btn-sm btn-danger">拒绝</a>\
          </td>\
        </tr>',
      props: ['franchise', 'idx'],
      methods: {
        review: function() {},
        accept: function() {
          var _self = this;
          data = {
            "action": "accept"
          }
          var json = JSON.stringify(data);

          $.ajax({
            type: "PUT",
            url: "/api/leagues/{{ league_id }}/franchises/" + _self.franchise._id,
            dataType: "json",
            data: json,
            contentType: 'application/json',
            success: function(data, status, xhr) {
              _self.franchise._status = 20
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
              if (XMLHttpRequest.status == 200) {
                _self.franchise._status = 20
              }
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        },
        reject: function() {
          var _self = this;
          data = {
            "action": "reject"
          }
          var json = JSON.stringify(data);

          $.ajax({
            type: "PUT",
            url: "/api/leagues/{{ league_id }}/franchises/" + _self.franchise._id,
            dataType: "json",
            data: json,
            contentType: 'application/json',
            success: function(data, status, xhr) {
              _self.franchise._status = 10
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
              if (XMLHttpRequest.status == 200) {
                _self.franchise._status = 10
              }
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        }
      }
    });

    new Vue({
      el: '#mgmt-table',
      data: {
        franchises: [],
        franchise_num: 0,
      },
      created: function() {
        this.queryFranchises(0, 20);
      },
      methods: {
        queryFranchises: function(idx, limit) {
          var _self = this;

          $.ajax({
            type: "GET",
            url: "/api/leagues/{{ league_id }}/franchises?filter=league&idx=" + idx + "&limit=" + limit,
            dataType: "json",
            contentType: 'application/json',
            success: function(data, status, xhr) {
              console.log(data);
              _self.franchises = data;
              _self.franchise_num += data.length;
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        },
      }
    });
  </script>

</body>

</html>

</html>
